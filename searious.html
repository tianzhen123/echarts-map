<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>大区</title>
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .echarts-map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div class="echarts-map">
        <!-- <div style="background-color: blue;">111</div> -->
        <div class="echarts-map-box" id="echartsMapBox" style="width: 100%;height: 100%"></div>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
        <script type="text/javascript" src="utils/echarts.min.js"></script>
        <script type="text/javascript" src="utils/china.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                repRegionStrategy();
            })
            var mergeProvinces = function (chinaJson, names, properties) {//合并大区里省份的coordinates
                var features = chinaJson.features;
                var polygons = [];
                var polygons2 = [];

                for (var i = 0; i < names.length; i++) {
                    var polygonsCoordinates = [];
                    var polygonsEncodeOffsets = [];
                    for (var z = 0; z < names[i].length; z++) {
                        for (var j = 0; j < features.length; j++) {
                            if (features[j].properties.name == names[i][z]) {
                                if (features[j].geometry.coordinates[0].constructor == String) {//合并coordinates
                                    for (var l = 0; l < features[j].geometry.coordinates.length; l++) {
                                        polygonsCoordinates.push(features[j].geometry.coordinates[l]);
                                    }

                                } else if (features[j].geometry.coordinates[0].constructor == Array) {
                                    for (var k = 0; k < features[j].geometry.coordinates.length; k++) {
                                        for (var d = 0; d < features[j].geometry.coordinates[k].length; d++) {
                                            polygonsCoordinates.push(features[j].geometry.coordinates[k][d]);
                                        }
                                    }
                                }



                                if (features[j].geometry.encodeOffsets[0].constructor == String) {//合并encodeOffsets
                                    polygonsEncodeOffsets.push(features[j].geometry.encodeOffsets);
                                } else if (features[j].geometry.encodeOffsets[0].constructor == Array) {
                                    for (var k = 0; k < features[j].geometry.encodeOffsets.length; k++) {
                                        if (features[j].geometry.encodeOffsets[k][0].constructor == Array) {
                                            for (var e = 0; e < features[j].geometry.encodeOffsets[k].length; e++) {
                                                polygonsEncodeOffsets.push(features[j].geometry.encodeOffsets[k][e]);
                                            }
                                        } else {
                                            polygonsEncodeOffsets.push(features[j].geometry.encodeOffsets[k]);
                                        }
                                    }
                                }

                                break;
                            }
                        }
                    }
                    polygons.push(polygonsCoordinates);
                    polygons2.push(polygonsEncodeOffsets);

                }

                // 构建新的合并区域
                var features = [];

                for (var a = 0; a < names.length; a++) {
                    var feature = {
                        id: features.length.toString(),
                        type: "FeatureCollection",
                        geometry: {
                            type: "Polygon",
                            coordinates: polygons[a],
                            encodeOffsets: polygons2[a]
                        },
                        properties: {
                            name: properties.name[a] || "",
                            childNum: polygons[a].length
                        }
                    };
                    if (properties.cp[a]) {
                        feature.properties.cp = properties.cp[a];
                    }

                    // 将新的合并区域添加到地图中
                    features.push(feature);
                }
                chinaJson.features = features;

            };

            function colorAreaObj (name, color, value) {
                this.name = name;
                this.value = value;
                this.itemStyle = {
                    normal: {
                        color: color,
                        show: false,
                    },
                    emphasis: {
                        color: color,
                        show: false,
                    },
                };
                this.label = {
                    normal: {
                        show: true,
                    },
                    emphasis: {
                        show: true,
                    },
                };
            }
            var pRChart = echarts.init(document.getElementById('echartsMapBox'));
            function repRegionStrategy () {
                $.get('utils/china.json', function (chinaJson) {
                    var params = {
                        names: [//把各个大区的省份用二维数组分开
                            ['北京', '天津', '河北', '山西', '内蒙古'],
                            ["黑龙江", "吉林", "辽宁"],
                            ['山东', '江苏', '安徽', '江西', '浙江', '福建', '上海'],
                            ['河南', '湖北', '湖南'],
                            ['广东', '广西', '海南', '香港', '澳门'],
                            ['重庆', '四川', '云南', '西藏', '贵州', '新疆'],
                            ['陕西', '甘肃', '青海', '宁夏'],
                            ['台湾']
                        ],
                        properties: {//自定义大区的名字，要和上面的大区省份一一对应
                            name: ['华北', '东北区域', '华东', '华中', '华南', '西南', '西北'],
                            cp: [//经纬度可以自己随意定义
                                [116.24, 39.54],
                                [126.32, 43.50],
                                [119.28, 31.13],
                                [114.20, 30.32],
                                [113.15, 23.08],
                                [104.04, 29.39],
                                [103.49, 36.03]
                            ]
                        }
                    };

                    mergeProvinces(chinaJson, params.names, params.properties);

                    echarts.registerMap('china', chinaJson); // 注册地图
                    

                    var colorAreaConfig = [//地图数据
                        {
                            "name": "东北区域",
                            "color": '#e400ff',
                            "value":20,
                        },
                        {
                            "name": "华北",
                            "color": "rgba(47,144,236,1)",
                            "value":2,
                        },
                        {
                            "name": "华南",
                            "color": "#2525d7",
                            "value":6,
                        },
                        {
                            "name": "华东",
                            "color": "rgba(254,62,62,1)",
                            "value":7,
                        },
                        {
                            "name": "华中",
                            "color": "rgba(176,58,91,1)",
                            "value":1,
                        },
                        {
                            "name": "西南",
                            "color": "#ee9a00",
                            "value":8,
                        },
                        {
                            "name": "西北",
                            "color": "#a5a279",
                            "value":5,
                        }
                    ];
                    data = colorAreaConfig.map(function (v, i) {
                        return new colorAreaObj(v.name, v.color,v.value);
                    });

                    option = {
                        backgroundColor: '#565670',//地图背景色
                        grid: {    //echarts地图距离容器位置
                            left: '50%',
                            top: '50%',
                            containLabel: true,
                        },
                        series: [
                            {
                                name: '大区',//城市
                                type: 'map',
                                map: 'china',
                                geoIndex: 1,
                                symbolSize: 20,
                                data: data,
                                zoom: 1,
                                layoutCenter: ["60%", "50%"],
                                layoutSize: "70%",
                                showLegendSymbol: true, // 存在legend时显示
                                label: {
                                    normal: {
                                        show: true,
                                        textStyle: {
                                            color: '#fff'
                                        },
                                        formatter:function(v){
                                            if(v.name && v.value) return v.name+v.value+'个'
                                            else return ' '
                                        }
                                    },
                                    emphasis: {//鼠标放上去时的状态
                                        show: true,
                                        textStyle: {
                                            color: '#333'
                                        }
                                    }
                                },
                                roam: true,//禁止拖拽和伸缩
                                itemStyle: {
                                    normal: {
                                        areaColor: '#d5d5d5',
                                        borderColor: '#d5d5d5',
                                        borderWidth: 0.5
                                    },
                                    emphasis: {
                                        areaColor: '#ffdf33'
                                    }
                                }
                            }
                        ]
                    };
                    pRChart.setOption(option, true);
                });
            }
            
            // 地图点击事件
            pRChart.on('click',param=>{
                const { name, componentType, componentSubType } = param
                switch (componentType) {
                    case 'series':
                        const type = componentSubType
                        switch (type){
                            case 'map':
                                console.log(param);
                        }
                }
            })
        </script>
    </div>
</body>

</html>